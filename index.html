<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Undangan Pernikahan - Erna & Reza</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lora:wght@400;600&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <style>
        @import url('https://fonts.cdnfonts.com/css/layla-thuluth');
        body {
            font-family: 'Lora', serif;
            scroll-behavior: smooth;
        }
        .font-playfair {
            font-family: 'Playfair Display', serif;
        }
        .font-dancing {
            font-family: 'Dancing Script', cursive;
        }
        .font-layla {
            font-family: 'Layla Thuluth', sans-serif;
        }
        /* Scroll/General Animation */
        .animate-on-load,
        .animate-scroll {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s ease-out, transform 0.8s ease-out;
        }
        .animate-on-load.is-visible,
        .animate-scroll.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
        .delay-1 { transition-delay: 0.2s; }
        .delay-2 { transition-delay: 0.4s; }
        .delay-3 { transition-delay: 0.6s; }
        .delay-4 { transition-delay: 0.8s; }

        .music-icon-playing {
            animation: spin 3s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        /* Style for background video */
        #hero-video {
            position: absolute;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: 0;
            transform: translateX(-50%) translateY(-50%);
            object-fit: cover;
        }
    </style>
</head>
<body class="bg-[#FFF8F9] text-[#4A4A4A]">

    <audio id="background-music" loop>
        <source src="https://raw.githubusercontent.com/ernaputriutami/wedding-invitation/main/media/Bernaung%20(From%20Setetes%20Embun%20Cinta%20Niyala).mp3" type="audio/mpeg">
        Browser Anda tidak mendukung elemen audio.
    </audio>

    <div id="music-control" class="hidden fixed bottom-5 right-5 z-50">
        <button onclick="toggleMusic()" class="w-12 h-12 bg-white/80 backdrop-blur-sm rounded-full flex items-center justify-center text-[#8D9DB6] shadow-lg">
            <svg id="music-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>
        </button>
    </div>

    <div id="cover" class="fixed inset-0 bg-cover bg-center bg-no-repeat flex flex-col justify-center items-center text-center text-white z-50" style="background-image: url('https://raw.githubusercontent.com/ernaputriutami/wedding-invitation/main/images/COVER.svg');">
        <div class="absolute inset-0 bg-black/50"></div>
        <div class="relative z-10 p-8 flex flex-col items-center">
            <h2 class="font-playfair text-xl tracking-wider">The Wedding Of</h2>
            <h1 class="font-dancing text-6xl md:text-8xl my-4">Erna & Reza</h1>
            <p class="mt-8 mb-2">Kepada Yth. Bapak/Ibu/Saudara/i</p>
            <p id="guest-name" class="text-2xl font-bold bg-white/20 px-4 py-2 rounded-lg">Nama Tamu</p>
            <button id="open-invitation" class="mt-8 bg-[#8D9DB6] hover:bg-[#7488A1] text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 12c0-4.4-3.6-8-8-8s-8 3.6-8 8 3.6 8 8 8 8-3.6 8-8Z"/><path d="m9.5 14.5 5-2.5-5-2.5v5Z"/></svg>
                Buka Undangan
            </button>
        </div>
    </div>

    <main id="main-content" class="hidden">
        <section class="h-screen flex flex-col justify-center items-center text-center text-white relative overflow-hidden">
             <video autoplay loop muted playsinline id="hero-video" poster="https://raw.githubusercontent.com/ernaputriutami/wedding-invitation/main/images/COVER.svg">
                <source src="https://raw.githubusercontent.com/ernaputriutami/wedding-invitation/main/media/Video-Art-Modern-Java-Compress.mp4" type="video/mp4">
                Browser Anda tidak mendukung tag video.
            </video>
            <div class="absolute inset-0 bg-black/50"></div>
            <div class="relative z-10">
                <h2 id="hero-h2" class="font-playfair text-2xl tracking-wider animate-on-load">We Are Getting Married</h2>
                <h1 id="hero-h1" class="font-dancing text-6xl md:text-8xl my-4 animate-on-load delay-1">Erna & Reza</h1>
                <p id="hero-p" class="text-xl animate-on-load delay-2">Minggu, 21.12.2025</p>
            </div>
        </section>

        <section class="py-20 px-4 text-center bg-[#FADADD]/30">
            <div class="container mx-auto max-w-4xl">
                <p dir="rtl" class="font-layla text-3xl text-[#7488A1] mb-6 text-center leading-relaxed animate-scroll">أَعُوذُ بِاللَّهِ مِنَ الشَّيْطَانِ الرَّجِيمِ<br></p>
                <p class="italic max-w-3xl mx-auto mb-4 animate-scroll delay-1">“Dan di antara tanda-tanda (kebesaran)-Nya ialah Dia menciptakan pasangan-pasangan untukmu dari jenismu sendiri, agar kamu cenderung dan merasa tenteram kepadanya, dan Dia menjadikan di antaramu rasa kasih dan sayang. Sungguh, pada yang demikian itu benar-benar terdapat tanda-tanda (kebesaran Allah) bagi kaum yang berpikir.”</p>
                <p class="font-semibold animate-scroll delay-2">(Q.S Ar-Rum : 21)</p>
            </div>
        </section>
        
        <section class="py-20 px-4 text-center bg-cover bg-center" style="background-image: url('https://raw.githubusercontent.com/ernaputriutami/wedding-invitation/main/images/DESIGN-TEMA-JAWA-EL-VB.jpg');">
            <div class="container mx-auto max-w-4xl bg-white/30 backdrop-blur-sm p-8 rounded-lg">
                 <h2 class="font-dancing text-2xl text-[#1e4b5c] mb-4 animate-scroll">Assalamu'alaikum warahmatullah wabarakatuh</h2>
                <p class="max-w-3xl mx-auto mb-12 animate-scroll delay-1">Dengan memohon Rahmat & Ridho Allah SWT, kami bermaksud mengundang Bapak/Ibu/Saudara/i untuk menghadiri acara pernikahan putra dan putri kami.</p>
                
                <div class="grid md:grid-cols-2 gap-12 items-center">
                    <div class="flex flex-col items-center animate-scroll delay-2">
                        <img src="https://raw.githubusercontent.com/ernaputriutami/wedding-invitation/main/images/wn-anime.png" alt="Mempelai Wanita" class="w-48 h-48 rounded-full object-cover shadow-lg mb-4">
                        <h3 class="font-dancing text-3xl text-[#1e4b5c]">Erna Putri Utami, S.Si</h3>
                        <p class="mt-2 font-semibold">Putri Pertama dari Pasangan</p>
                        <p>Bapak Asep Sudrajat & Ibu Sari Ningrum</p>
                    </div>
                    <div class="flex flex-col items-center animate-scroll delay-3">
                        <img src="https://raw.githubusercontent.com/ernaputriutami/wedding-invitation/main/images/lk-anime.png" alt="Mempelai Pria" class="w-48 h-48 rounded-full object-cover shadow-lg mb-4">
                        <h3 class="font-dancing text-3xl text-[#1e4b5c]">Reza Hafiz Pranajaya, S.Kel</h3>
                        <p class="mt-2 font-semibold">Putra Pertama dari Pasangan</p>
                        <p>Bapak Agung Prasojo & Ibu Estulah Jayati</p>
                    </div>                      
                </div>
            </div>
        </section>
        
        <section id="acara" class="py-20 px-4 bg-cover bg-center" style="background-image: url('https://raw.githubusercontent.com/ernaputriutami/wedding-invitation/main/images/DESIGN-TEMA-JAWA-EL-VB.jpg');">
            <div class="container mx-auto max-w-4xl text-center">
                <h2 class="font-dancing text-5xl text-[#1e4b5c] mb-12 animate-scroll">Detail Acara</h2>
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-white/80 backdrop-blur-sm p-8 rounded-lg shadow-lg animate-scroll delay-1">
                        <h3 class="font-playfair text-3xl font-bold text-[#7488A1]">Akad Nikah</h3>
                        <p class="mt-4 mb-2 text-lg font-semibold">Minggu, 21 Desember 2025</p>
                        <p>Pukul 09:00 - 11:00 WIB</p>
                        <p class="mt-4 font-semibold">Gedung Widaria Kencana Sukabumi</p>
                        <p>Jl. Lkr. Sel., Sukakarya, Kec. Warudoyong, Kota Sukabumi, Jawa Barat 43135</p>
                    </div>
                    <div class="bg-white/80 backdrop-blur-sm p-8 rounded-lg shadow-lg animate-scroll delay-2">
                        <h3 class="font-playfair text-3xl font-bold text-[#7488A1]">Resepsi</h3>
                        <p class="mt-4 mb-2 text-lg font-semibold">Minggu, 21 Desember 2025</p>
                        <p>Pukul 11:00 - 14:00 WIB</p>
                        <p class="mt-4 font-semibold">Gedung Widaria Kencana Sukabumi</p>
                        <p>Jl. Lkr. Sel., Sukakarya, Kec. Warudoyong, Kota Sukabumi, Jawa Barat 43135</p>
                    </div>
                </div>
                <div id="countdown" class="mt-12 text-2xl font-bold grid grid-cols-4 gap-4 max-w-lg mx-auto animate-scroll delay-3">
                    <div class="bg-white/80 p-4 rounded-lg shadow-md"><span id="days">00</span><p class="text-sm font-normal">Hari</p></div>
                    <div class="bg-white/80 p-4 rounded-lg shadow-md"><span id="hours">00</span><p class="text-sm font-normal">Jam</p></div>
                    <div class="bg-white/80 p-4 rounded-lg shadow-md"><span id="minutes">00</span><p class="text-sm font-normal">Menit</p></div>
                    <div class="bg-white/80 p-4 rounded-lg shadow-md"><span id="seconds">00</span><p class="text-sm font-normal">Detik</p></div>
                </div>
            </div>
        </section>

        <section class="py-20 px-4 text-center">
             <div class="container mx-auto max-w-4xl">
                 <h2 class="font-dancing text-5xl text-[#8D9DB6] mb-8 animate-scroll">Peta Lokasi</h2>
                 <div class="w-full h-96 rounded-lg shadow-lg overflow-hidden animate-scroll delay-1">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3960.6566567505242!2d106.89930487499659!3d-6.931577693068283!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e6837dd201b96df%3A0x7654148d7d645730!2sGedung%20Widaria%20Kencana%20Sukabumi!5e0!3m2!1sid!2sid!4v1759907495004!5m2!1sid!2sid" width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                 </div>
                 <a href="https://maps.app.goo.gl/wYgK889MRWU26DY87" target="_blank" class="inline-block mt-8 bg-[#8D9DB6] hover:bg-[#7488A1] text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105 animate-scroll delay-2">
                     Buka di Google Maps
                </a>
            </div>
        </section>
        
        <section id="hadiah" class="py-20 px-4 bg-[#FADADD]/30">
            <div class="container mx-auto max-w-4xl text-center">
                <h2 class="font-dancing text-5xl text-[#8D9DB6] mb-4 animate-scroll">Kirim Hadiah</h2>
                <p class="max-w-2xl mx-auto mb-12 animate-scroll delay-1">Doa restu Anda merupakan karunia yang sangat berarti bagi kami. Namun jika memberi adalah ungkapan tanda kasih, Anda dapat memberi kado secara cashless.</p>
                <div class="grid md:grid-cols-2 gap-8 text-left">
                    <div class="bg-white p-6 rounded-lg shadow-md animate-scroll delay-2">
                        <h3 class="font-semibold text-lg flex items-center gap-2"><img src="https://raw.githubusercontent.com/ernaputriutami/wedding-invitation/main/images/iconmandiri-1.png" class="h-6" alt="Logo Bank Mandiri"> Bank Mandiri</h3>
                        <p class="mt-2 text-gray-500">a.n. Erna Putri Utami</p>
                        <p id="mandiri-account" class="text-xl font-bold">1270010070157</p>
                        <button onclick="copyToClipboard('mandiri-account', this)" class="mt-2 text-sm bg-gray-200 px-3 py-1 rounded-full">Salin Nomor</button>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md animate-scroll delay-3">
                        <h3 class="font-semibold text-lg flex items-center gap-2"><img src="https://upload.wikimedia.org/wikipedia/commons/7/72/Logo_dana_blue.svg" class="h-5" alt="Logo DANA E-Wallet"> DANA</h3>
                        <p class="mt-2 text-gray-500">a.n. Reza Hafiz Pranajaya</p>
                        <p id="dana-account" class="text-xl font-bold">085695496600</p>
                        <button onclick="copyToClipboard('dana-account', this)" class="mt-2 text-sm bg-gray-200 px-3 py-1 rounded-full">Salin Nomor</button>
                    </div>
                </div>
            </div>
        </section>

        <section class="py-20 px-4">
            <div class="container mx-auto max-w-2xl text-center">
                <h2 class="font-dancing text-5xl text-[#8D9DB6] mb-8 animate-scroll">Konfirmasi Kehadiran</h2>
                <form id="rsvp-form" class="bg-white p-8 rounded-lg shadow-lg text-left space-y-4 animate-scroll delay-1">
                    <div>
                        <label for="name" class="block mb-2 font-semibold">Nama Anda</label>
                        <input type="text" id="name" name="name" class="w-full p-2 border rounded-md" required>
                    </div>
                    <div>
                        <label class="block mb-2 font-semibold">Konfirmasi Kehadiran</label>
                        <select id="status" name="status" class="w-full p-2 border rounded-md">
                            <option value="Hadir">Ya, saya akan hadir</option>
                            <option value="Tidak Hadir">Maaf, tidak bisa hadir</option>
                        </select>
                    </div>
                     <div>
                        <label for="guests" class="block mb-2 font-semibold">Jumlah Tamu</label>
                        <select id="guests" name="guests" class="w-full p-2 border rounded-md bg-white">
                            <option value="1">1 orang</option>
                            <option value="2">2 orang</option>
                        </select>
                    </div>
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <label for="message" class="block font-semibold">Ucapan & Doa</label>
                            <button type="button" id="generate-wish-btn" class="text-sm text-[#8D9DB6] hover:underline flex items-center gap-1">
                                ✨ Buatkan Ucapan
                            </button>
                        </div>
                        <textarea id="message" name="message" rows="4" class="w-full p-2 border rounded-md" placeholder="Tulis ucapan dan doa Anda di sini..." required></textarea>
                        <p id="gemini-error" class="text-red-500 text-sm mt-1 hidden"></p>
                    </div>
                    <button type="submit" class="w-full mt-4 bg-[#8D9DB6] hover:bg-[#7488A1] text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105">Kirim Konfirmasi</button>
                </form>
                <div id="rsvp-success" class="hidden mt-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg relative" role="alert">
                    <strong class="font-bold">Terima kasih!</strong>
                    <span class="block sm:inline"> Konfirmasi Anda telah kami terima.</span>
                </div>
                <!-- IMPROVEMENT: Added a dedicated error message container instead of using alert() -->
                <div id="rsvp-error" class="hidden mt-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative" role="alert">
                    <strong class="font-bold">Oops!</strong>
                    <span class="block sm:inline"> Terjadi kesalahan saat mengirim konfirmasi. Silakan coba lagi.</span>
                </div>
            </div>

            <div id="wishes-section" class="container mx-auto max-w-2xl text-center mt-12 animate-scroll delay-2">
                <h2 class="font-dancing text-5xl text-[#8D9DB6] mb-8">Ucapan & Doa Restu</h2>
                <div id="wishes-list" class="bg-white p-6 rounded-lg shadow-lg text-left space-y-4 max-h-96 overflow-y-auto">
                    <p id="loading-wishes" class="text-center text-gray-500">Memuat ucapan...</p>
                </div>
            </div>
        </section>

        <footer class="text-center py-12 px-4">
            <p class="animate-scroll">Merupakan suatu kehormatan dan kebahagiaan bagi kami apabila Bapak/Ibu/Saudara/i berkenan hadir untuk memberikan doa restu kepada kedua mempelai.</p>
            <p class="font-dancing text-3xl my-4 animate-scroll delay-1">Erna & Reza</p>
            <p class="text-sm text-gray-500 mt-8 animate-scroll delay-2">Dibuat dengan ❤️</p>
        </footer>
    </main>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // !!! PENTING: GANTI URL DI BAWAH INI DENGAN URL WEB APP GOOGLE SCRIPT ANDA !!!
            const scriptURL = 'https://script.google.com/macros/s/AKfycbxgu_JmVq8sA4h7YyrI7f-GiyETJvMSV23gAd9-9EVPGgi5YUPTJpkFdITbcDH05EoO/exec'; 
            
            const urlParams = new URLSearchParams(window.location.search);
            const guest = urlParams.get('to') || 'Tamu Undangan';
            document.getElementById('guest-name').textContent = guest.replace(/_/g, ' ');

            const openButton = document.getElementById('open-invitation');
            const cover = document.getElementById('cover');
            const mainContent = document.getElementById('main-content');
            const music = document.getElementById('background-music');
            const musicControl = document.getElementById('music-control');
            
            // Video and Hero Text elements
            const video = document.getElementById('hero-video');
            const heroH2 = document.getElementById('hero-h2');
            const heroH1 = document.getElementById('hero-h1');
            const heroP = document.getElementById('hero-p');
            let heroAnimationTriggered = false;

            video.addEventListener('timeupdate', function() {
                // Timestamp diubah menjadi 7 detik agar lebih cepat
                if (video.currentTime >= 7 && !heroAnimationTriggered) { 
                    heroH2.classList.add('is-visible');
                    heroH1.classList.add('is-visible');
                    heroP.classList.add('is-visible');
                    heroAnimationTriggered = true; 
                }
            });

            openButton.addEventListener('click', function() {
                cover.style.transition = 'opacity 1s, transform 1s';
                cover.style.opacity = '0';
                cover.style.transform = 'scale(1.1)';
                setTimeout(() => cover.style.display = 'none', 1000);

                mainContent.style.display = 'block';
                document.body.style.overflow = 'auto';
                
                // Mengatur kecepatan putar video menjadi 1.5x lebih cepat
                const video = document.getElementById('hero-video');
                video.playbackRate = 1.5; 
                
                music.play().catch(error => console.log("Autoplay dicegah oleh browser."));
                musicControl.style.display = 'block';

                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('is-visible');
                            observer.unobserve(entry.target);
                        }
                    });
                }, { threshold: 0.1 });

                document.querySelectorAll('.animate-scroll').forEach(element => {
                    observer.observe(element);
                });

                getWishes();
            });

            const countdownDate = new Date("December 21, 2025 09:00:00").getTime();
            const countdownFunction = setInterval(function() {
                const now = new Date().getTime();
                const distance = countdownDate - now;

                if (distance < 0) {
                    clearInterval(countdownFunction);
                    document.getElementById("countdown").innerHTML = "<div class='col-span-4'>Acara Telah Berlangsung</div>";
                    return;
                }
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                document.getElementById("days").innerText = String(days).padStart(2, '0');
                document.getElementById("hours").innerText = String(hours).padStart(2, '0');
                document.getElementById("minutes").innerText = String(minutes).padStart(2, '0');
                document.getElementById("seconds").innerText = String(seconds).padStart(2, '0');
            }, 1000);

            const rsvpForm = document.getElementById('rsvp-form');
            const submitButton = rsvpForm.querySelector('button[type="submit"]');
            rsvpForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // IMPROVEMENT: Hide previous error message on new submission
                document.getElementById('rsvp-error').style.display = 'none';

                submitButton.disabled = true;
                submitButton.textContent = 'Mengirim...';

                fetch(scriptURL, { method: 'POST', body: new FormData(rsvpForm)})
                    .then(response => {
                        console.log('Success!', response);
                        const rsvpSuccess = document.getElementById('rsvp-success');
                        rsvpForm.style.display = 'none';
                        rsvpSuccess.style.display = 'block';
                        getWishes();
                    })
                    .catch(error => {
                        console.error('Error!', error.message);
                        // IMPROVEMENT: Replaced alert() with a non-blocking UI element for better UX
                        const rsvpError = document.getElementById('rsvp-error');
                        rsvpError.style.display = 'block';
                        submitButton.disabled = false;
                        submitButton.textContent = 'Kirim Konfirmasi';
                    });
            });
            
            // --- Gemini API Feature ---
            const generateWishBtn = document.getElementById('generate-wish-btn');
            const messageTextarea = document.getElementById('message');
            const nameInput = document.getElementById('name');
            const geminiError = document.getElementById('gemini-error');

            generateWishBtn.addEventListener('click', generateWish);

            async function generateWish() {
                const guestName = nameInput.value.trim() || 'Sahabat';
                const originalButtonText = generateWishBtn.innerHTML;
                
                generateWishBtn.disabled = true;
                generateWishBtn.innerHTML = `
                    <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-[#8D9DB6]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Membuat...
                `;
                geminiError.classList.add('hidden');

                const apiKey = ""; // API Key will be handled by the environment.
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const prompt = `Tuliskan sebuah ucapan dan doa pernikahan yang singkat (sekitar 2-3 kalimat), tulus, dan indah untuk pasangan bernama Reza dan Erna. Ucapan ini datang dari tamu mereka yang bernama ${guestName}. Gunakan bahasa Indonesia yang baik dan sopan. Jangan gunakan markdown.`;
                const payload = { contents: [{ parts: [{ text: prompt }] }] };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) throw new Error(`API request failed with status ${response.status}`);

                    const result = await response.json();
                    const candidate = result.candidates?.[0];

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        messageTextarea.value = candidate.content.parts[0].text.trim();
                    } else {
                        throw new Error('Gagal mendapatkan teks dari respons API.');
                    }
                } catch (error) {
                    console.error("Error calling Gemini API:", error);
                    geminiError.textContent = "Maaf, gagal membuat ucapan. Coba lagi nanti.";
                    geminiError.classList.remove('hidden');
                } finally {
                    generateWishBtn.disabled = false;
                    generateWishBtn.innerHTML = originalButtonText;
                }
            }

            function getWishes() {
                const wishesList = document.getElementById('wishes-list');
                wishesList.innerHTML = '<p id="loading-wishes" class="text-center text-gray-500">Memuat ucapan...</p>';

                fetch(scriptURL)
                    .then(response => response.json())
                    .then(data => {
                        wishesList.innerHTML = '';
                        if (data.records && data.records.length > 0) {
                            data.records.forEach(wish => {
                                const wishElement = document.createElement('div');
                                wishElement.className = 'border-b pb-3 mb-3';
                                wishElement.innerHTML = `
                                    <div class="flex justify-between items-center flex-wrap">
                                        <p class="font-bold text-[#7488A1]">${wish.Nama}</p>
                                        <span class="text-xs ${wish.Status === 'Hadir' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'} px-2 py-1 rounded-full mt-1 sm:mt-0">${wish.Status === 'Hadir' ? `${wish.JumlahTamu} orang akan hadir` : 'Tidak Hadir'}</span>
                                    </div>
                                    <p class="mt-2 text-gray-600 italic">"${wish.Pesan}"</p>
                                `;
                                wishesList.appendChild(wishElement);
                            });
                        } else {
                            wishesList.innerHTML = '<p class="text-center text-gray-500">Jadilah yang pertama mengirim ucapan!</p>';
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching wishes:', error);
                        wishesList.innerHTML = '<p class="text-center text-gray-500">Gagal memuat ucapan. Periksa kembali URL Script Anda.</p>';
                    });
            }
        });
        
        function toggleMusic() {
            const music = document.getElementById('background-music');
            const icon = document.getElementById('music-icon');
            if (music.paused) {
                music.play();
                icon.classList.add('music-icon-playing');
            } else {
                music.pause();
                icon.classList.remove('music-icon-playing');
            }
        }

        function copyToClipboard(elementId, button) {
            const textToCopy = document.getElementById(elementId).innerText;
            const tempInput = document.createElement('input');
            document.body.appendChild(tempInput);
            tempInput.value = textToCopy;
            tempInput.select();
            try {
                document.execCommand('copy');
                const originalText = button.innerText;
                button.innerText = 'Berhasil Disalin!';
                setTimeout(() => {
                    button.innerText = originalText;
                }, 2000);
            } catch (err) {
                console.error('Gagal menyalin: ', err);
            }
            document.body.removeChild(tempInput);
        }

    </script>
</body>
</html>
